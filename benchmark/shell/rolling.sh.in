#!/usr/bin/env bash

DT_ARRAY=( "0.00001" "0.00004" "0.0001" "0.0004" "0.001" "0.004" "0.01" "0.04" "0.1" )

# options
raisim_installed="@BENCHMARK_RAISIM@"
bulletsim_installed="@BENCHMARK_BULLET@"
odesim_installed="@BENCHMARK_ODE@"
mujocosim_installed="@BENCHMARK_MUJOCO@"

raisim_flag=''
bullet_flag=''
ode_flag=''
mujoco_flag=''

echo "----------------------"
echo "Benchmark rolling test"

while getopts 'rbom' flag; do
  case "${flag}" in
    r) raisim_flag='true'; echo "Test raisim" ;;
    b) bullet_flag='true'; echo "Test bullet" ;;
    o) ode_flag='true'; echo "Test ode" ;;
    m) mujoco_flag='true'; echo "Test mujoco" ;;
    *) error "Unexpected option ${flag}" ;;
  esac
done

echo "----------------------"

# benchmark test
for dt in ${DT_ARRAY[@]}
do
    for forcedir in xy y
    do
        # rai sim
        if [ "$raisim_flag" == 'true' ]; then
            if [ "$raisim_installed" == "ON" ]; then
                for erpon in true false
                do
                    ./rollingRaiSim --nogui --erp-on=$erpon --dt=$dt --force-direction=$forcedir
                done
            else
                echo "raisim is not built. turn on BENCHMARK_RAISIM option in cmake"
            fi
        fi

        # bullet sim
        if [ "$bullet_flag" == 'true' ]; then
            if [ "$bulletsim_installed" == "ON" ]; then
                for solver in seqImp nncg pgs dantzig #lemke
                do
                    for erpon in true false
                    do
                        ./rollingBulletSim --nogui --erp-on=$erpon --dt=$dt --solver=$solver --force-direction=$forcedir
                    done
                done
            else
                echo "bulletsim is not built. turn on BENCHMARK_BULLETSIM option in cmake"
            fi
        fi

        # ode sim
        if [ "$ode_flag" == 'true' ]; then
            if [ "$odesim_installed" == "ON" ] ; then
                for solver in std quick
                do
                    for erpon in true false
                    do
                        ./rollingODESim --nogui --erp-on=$erpon --dt=$dt --solver=$solver --force-direction=$forcedir
                    done
                done
            else
                echo "odesim is not built. turn on BENCHMARK_ODESIM option in cmake"
            fi
        fi

        # mujoco sim
        if [ "$mujoco_flag" == 'true' ]; then
            if [ "$mujocosim_installed" == "ON" ] ; then
                for solver in pgs cg newton
                do
                    ./rollingMuJoCoSim --nogui --dt=$dt --solver=$solver --force-direction=$forcedir
                done
            else
                echo "mujocosim is not built. turn on BENCHMARK_MUJOCOSIM option in cmake"
            fi
        fi
    done
done